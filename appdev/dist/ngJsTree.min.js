!function(e,t){"use strict";e.jstree.defaults.alltrigger=null,e.jstree.plugins.alltrigger=function(t,n){this.init=function(r,a){if(t){this.trigger=function(e,r){n.trigger.call(this,e,r),t(e.replace(".jstree","")+".jstree",r)};var i=e.vakata.context._trigger;e.vakata.context._trigger=function(e){i(e),t("context_"+e+".vakata")};var o=e.vakata.dnd._trigger;e.vakata.dnd._trigger=function(e,n,r){o(e,n,r),t("dnd_"+e+".vakata",n,r)}}n.init.call(this,r,a)}}}(jQuery),function(e){"use strict";function t(){var t=1,n=this;n.nodesFingerprint=function(e){return e.__uiNodeId||(e.__uiNodeId=t++),""+e.__uiNodeId+(e.id||"")+(e.text||"")+(e.type||"")},n.changeWatcher=function(t,n){var r,a=function(){var r,a,i=[];if(t)for(var s=e.isFunction(t)?t():t,u=0,p=s.length;u<p;u++)a=s[u],r=n(a),o[r]=a,i.push(r);return i},i=function(e,t){var n,r,a=[],i={};for(n=0,r=t.length;n<r;n++)i[t[n]]=!0;for(n=0,r=e.length;n<r;n++)i[e[n]]||a.push(e[n]);return a},o={},s=function(e,t){var a,s,u,p,c={},l=i(t,e);for(a=0,s=l.length;a<s;a++){var f=l[a];u=o[f],delete o[f];var d=n(u);d===f?r.onRemoved(u):(c[d]=f,r.onChanged(u))}var g=i(e,t);for(a=0,s=g.length;a<s;a++)p=g[a],u=o[p],c[p]||r.onAdded(u)};return r={subscribe:function(e,t){e.$watch(a,function(e,n){t&&t(e,n)===!1||s(e,n)},!0)},onAdded:e.noop,onChanged:e.noop,onRemoved:e.noop}}}function n(t){return{restrict:"A",scope:{treeData:"=ngModel",treeEventsObj:"=?treeEventsObj",shouldApply:"&"},controller:"jsTreeCtrl",link:function(n,r,a,i){function o(e,t){return function(){var n=arguments,r=e.$parent.$eval(t);e.$root.$$phase?r.apply(e.$parent,n):e.$parent.$apply(function(){r.apply(e.$parent,n)})}}function s(t,n,r){if(r.treeEvents)for(var a=r.treeEvents.split(";"),i=0;i<a.length;i++)if(a[i].length>0){var s=a[i].split(":")[0],u=a[i].split(":")[1];s.indexOf(".")===-1&&(s+=".jstree"),l.push(s),s.indexOf(".vakata")===-1?t.tree.on(s,o(t,u)):$(document).on(s,o(t,u))}e.isObject(t.treeEventsObj)&&e.forEach(t.treeEventsObj,function(e,n){n.indexOf(".")===-1&&(n+=".jstree"),l.push(n),n.indexOf(".vakata")===-1?t.tree.on(n,function(){var n=arguments;t.$root.$$phase?e.apply(t.$parent,n):t.$parent.$apply(function(){e.apply(t.$parent,n)})}):$(document).on(n,function(){var n=arguments;t.$root.$$phase?e.apply(t.$parent,n):t.$parent.$apply(function(){e.apply(t.$parent,n)})})})}function u(){var t=a.jsTree?n.$parent.$eval(a.jsTree):{};p={},e.copy(t,p);var r=JSON.stringify(p);return p.core?p.core.data=n.treeData:p.core={data:n.treeData},p.plugins?p.plugins.push("alltrigger"):p.plugins=["alltrigger"],p.alltrigger=function(e){n.$root.$$phase||l.indexOf(e)!==-1||n.$apply()},r}var p=null,c=i.changeWatcher(n.treeData,i.nodesFingerprint),l=[],f=!1;n.destroy=function(){if(l=[],a.tree)if(a.tree.indexOf(".")!==-1){for(var e=a.tree.split("."),t=e.pop(),i=n.$parent,o=0;o<e.length;o++)i=i[e[o]];n.tree=i[t]=r}else n.tree=n.$parent[a.tree]=r;else n.tree=r;n.tree.jstree("destroy")},n.init=function(){n.tree.jstree(p),t(function(){s(n,r,a)})},c.onChanged=function(t){e.isDefined(n.tree.jstree(!0).set_type)&&n.tree.jstree(!0).set_type(t.id,t.type),n.tree.jstree(!0).rename_node(t.id,t.text)},c.onAdded=function(e){t(function(){for(;f;);f=!0;var t=n.tree.jstree(!0).get_node(e.parent);n.tree.jstree(!0).create_node(t,e,"inside",function(){f=!1})||(f=!1)})},c.onRemoved=function(e){n.tree.jstree(!0).delete_node(e.id)},c.subscribe(n,function(){return!n.shouldApply||n.shouldApply()}),n.$watch(u,function(){n.destroy(),n.init()})}}}var r=e.module("ngJsTree",[]);r.controller("jsTreeCtrl",t),r.directive("jsTree",["$timeout",n])}(angular);