!function(e){"use strict";function t(){var t=1;this.nodesFingerprint=function(e){return e.__uiNodeId||(e.__uiNodeId=t++),""+e.__uiNodeId+(e.id||"")+(e.text||"")+(e.type||"")},this.changeWatcher=function(t,r){var n,o=function(){var n,o,i=[];if(t)for(var s=e.isFunction(t)?t():t,d=0,u=s.length;u>d;d++)o=s[d],n=r(o),a[n]=o,i.push(n);return i},i=function(e,t){var r,n,o=[],i={};for(r=0,n=t.length;n>r;r++)i[t[r]]=!0;for(r=0,n=e.length;n>r;r++)i[e[r]]||o.push(e[r]);return o},a={},s=function(e,t){var o,s,d,u,c={},f=i(t,e);for(o=0,s=f.length;s>o;o++){var l=f[o];d=a[l],delete a[l];var p=r(d);p===l?n.onRemoved(d):(c[p]=l,n.onChanged(d))}var v=i(e,t);for(o=0,s=v.length;s>o;o++)u=v[o],d=a[u],c[u]||n.onAdded(d)};return n={subscribe:function(e,t){e.$watch(o,function(e,r){t&&t(e,r)===!1||s(e,r)},!0)},onAdded:e.noop,onChanged:e.noop,onRemoved:e.noop}}}function r(){return{restrict:"A",scope:{treeData:"=ngModel",shouldApply:"&"},controller:"jsTreeCtrl",link:function(t,r,n,o){function i(e,t,r){if(r.treeEvents)for(var n=r.treeEvents.split(";"),o=0;o<n.length;o++)if(n[o].length>0){var i=n[o].split(":")[0],a=i+".jstree",s=n[o].split(":")[1];e.tree.on(a,e.$parent.$eval(s))}}function a(){var r=n.jsTree?t.$parent.$eval(n.jsTree):{};s={},e.copy(r,s);var o=JSON.stringify(s);return s.core?s.core.data=t.treeData:s.core={data:t.treeData},o}var s=null,d=o.changeWatcher(t.treeData,o.nodesFingerprint),u=!1;t.destroy=function(){if(n.tree)if(-1!==n.tree.indexOf(".")){var e=n.tree.split(".");t.tree=t.$parent[e[0]][e[1]]=r}else t.tree=t.$parent[n.tree]=r;else t.tree=r;t.tree.jstree("destroy")},t.init=function(){t.tree.jstree(s),i(t,r,n)},d.onChanged=function(r){e.isDefined(t.tree.jstree(!0).set_type)&&t.tree.jstree(!0).set_type(r.id,r.type),t.tree.jstree(!0).rename_node(r.id,r.text)},d.onAdded=function(e){for(;u;);u=!0;var r=t.tree.jstree(!0).get_node(e.parent),n=t.tree.jstree(!0).create_node(r,e,"inside",function(){u=!1});n||(u=!1)},d.onRemoved=function(e){t.tree.jstree(!0).delete_node(e.id)},d.subscribe(t,function(){return t.shouldApply?t.shouldApply():!0}),t.$watch(a,function(){t.destroy(),t.init()})}}}var n=e.module("ngJsTree",[]);n.controller("jsTreeCtrl",t),n.directive("jsTree",r)}(angular);