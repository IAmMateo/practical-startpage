!function(e){"use strict";function t(){var t=1,r=this;r.nodesFingerprint=function(e){return e.__uiNodeId||(e.__uiNodeId=t++),""+e.__uiNodeId+(e.id||"")+(e.text||"")+(e.type||"")},r.changeWatcher=function(t,r){var n,o=function(){var n,o,i=[];if(t)for(var a=e.isFunction(t)?t():t,d=0,c=a.length;c>d;d++)o=a[d],n=r(o),s[n]=o,i.push(n);return i},i=function(e,t){var r,n,o=[],i={};for(r=0,n=t.length;n>r;r++)i[t[r]]=!0;for(r=0,n=e.length;n>r;r++)i[e[r]]||o.push(e[r]);return o},s={},a=function(e,t){var o,a,d,c,u={},f=i(t,e);for(o=0,a=f.length;a>o;o++){var l=f[o];d=s[l],delete s[l];var p=r(d);p===l?n.onRemoved(d):(u[p]=l,n.onChanged(d))}var v=i(e,t);for(o=0,a=v.length;a>o;o++)c=v[o],d=s[c],u[c]||n.onAdded(d)};return n={subscribe:function(e,t){e.$watch(o,function(e,r){t&&t(e,r)===!1||a(e,r)},!0)},onAdded:e.noop,onChanged:e.noop,onRemoved:e.noop}}}function r(){return{restrict:"A",scope:{treeData:"=ngModel",treeEventsObj:"=?treeEventsObj",shouldApply:"&"},controller:"jsTreeCtrl",link:function(t,r,n,o){function i(t,r,n){if(n.treeEvents){for(var o=n.treeEvents.split(";"),i=0;i<o.length;i++)if(o[i].length>0){var s=o[i].split(":")[0],a=s+".jstree",d=o[i].split(":")[1];t.tree.on(a,t.$parent.$eval(d))}}else e.isObject(t.treeEventsObj)&&e.forEach(t.treeEventsObj,function(e,r){var n=r+".jstree";t.tree.on(n,e)})}function s(){var r=n.jsTree?t.$parent.$eval(n.jsTree):{};a={},e.copy(r,a);var o=JSON.stringify(a);return a.core?a.core.data=t.treeData:a.core={data:t.treeData},o}var a=null,d=o.changeWatcher(t.treeData,o.nodesFingerprint),c=!1;t.destroy=function(){if(n.tree)if(-1!==n.tree.indexOf(".")){for(var e=n.tree.split("."),o=e.pop(),i=t.$parent,s=0;s<e.length;s++)i=i[e[s]];t.tree=i[o]=r}else t.tree=t.$parent[n.tree]=r;else t.tree=r;t.tree.jstree("destroy")},t.init=function(){t.tree.jstree(a),i(t,r,n)},d.onChanged=function(r){e.isDefined(t.tree.jstree(!0).set_type)&&t.tree.jstree(!0).set_type(r.id,r.type),t.tree.jstree(!0).rename_node(r.id,r.text)},d.onAdded=function(e){for(;c;);c=!0;var r=t.tree.jstree(!0).get_node(e.parent),n=t.tree.jstree(!0).create_node(r,e,"inside",function(){c=!1});n||(c=!1)},d.onRemoved=function(e){t.tree.jstree(!0).delete_node(e.id)},d.subscribe(t,function(){return t.shouldApply?t.shouldApply():!0}),t.$watch(s,function(){t.destroy(),t.init()})}}}var n=e.module("ngJsTree",[]);n.controller("jsTreeCtrl",t),n.directive("jsTree",r)}(angular);